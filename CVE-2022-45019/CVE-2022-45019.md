## CVE-2022-45019

**CVE Reverse Engineering**

What we will do is that download and install SLIMS-9.5.0 Open source Project and Find the SQL injection vulnerability in keywords Parameter via Backbox perspective and white-box perspective both.

**Where Vulnerability exist**

When you search anything that search keyword is used keywords parameter like keyword=click

While analyzing the source code of outdate version DefaultEnging.php have function that is getDocuments()

that is vulnerable to sqli injection

Vulnerable code of **Slims9 bulian 9.5.0** is blow



```php
   function getDocuments()
    {
        // start time to benchmarking
        $start = microtime(true);

        // build sql command
        $sql = $this->buildSQL();

        // execute query
        $db = DB::getInstance();
        $count = $db->query($sql['count']);
        $query = $db->query($sql['query']);

        // get results
        $this->num_rows = ($count->fetch(\PDO::FETCH_NUM))[0] ?? 0;
        $this->documents = $query->fetchAll(\PDO::FETCH_ASSOC);

        // end time
        $end = microtime(true);
        $this->query_time = round($end - $start, 5);
    }
```

In updated version of slims bulian 9.5.1 they used prepare statement

```php
function getDocuments()
    {
        // start time to benchmarking
        $start = microtime(true);

        try {
            // build sql command
            $sql = $this->buildSQL();

            // debug if in development.
            if (ENVIRONMENT == 'development') DB::debug();

            // execute query
            $db = DB::getInstance();
            // dd($sql['count'],$this->execute);
            $count = $db->prepare($sql['count']);
            $count->execute($this->execute);
            $query = $db->prepare($sql['query']);
            $query->execute($this->execute);

            // get results
            $this->num_rows = ($count->fetch(\PDO::FETCH_NUM))[0] ?? 0;
            $this->documents = $query->fetchAll(\PDO::FETCH_ASSOC);
        } catch (\PDOException | \Exception $e) {
            $this->error = $e->getMessage();
        }

        // end time
        $end = microtime(true);
        $this->query_time = round($end - $start, 5);
    }
```

while looking into the function before they did not use prepare statement now they use prepare statement in updated version



